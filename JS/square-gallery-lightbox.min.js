function imageLightbox(t,e){var n=0,i=0,o=0,a=$(),r=[],l=!1;options={},targetID=0;var s=this,d=function(){var t=document.body||document.documentElement,t=t.style;return""==t.WebkitTransition?"-webkit-":""==t.MozTransition?"-moz-":""==t.OTransition?"-o-":""==t.transition?"":!1},g=d()===!1?!1:!0,f=function(t,e,n){var i={},o=d();i[o+"transform"]="translateX("+e+")",i[o+"transition"]=o+"transform "+n+"s linear",t.css(i)},u="ontouchstart"in window,p=window.navigator.pointerEnabled||window.navigator.msPointerEnabled,c=function(t){if(u)return!0;if(!p||"undefined"==typeof t||"undefined"==typeof t.pointerType)return!1;if("undefined"!=typeof t.MSPOINTER_TYPE_MOUSE){if(t.MSPOINTER_TYPE_MOUSE!=t.pointerType)return!0}else if("mouse"!=t.pointerType)return!0;return!1};this.setOptions=function(t){options=$.extend({selector:'id="imagelightbox"',allowedTypes:"png|jpg|jpeg|gif",animationSpeed:250,preloadNext:!0,enableKeyboard:!0,quitOnEnd:!1,quitOnImgClick:!1,quitOnDocClick:!0,onStart:!1,onEnd:!1,onLoadStart:!1,onLoadEnd:!1,fillMode:2},t)},this.updateoptions=function(t){options=$.extend(options,t)},this.setGallery=function(t){r=t},"undefined"!=typeof e?(this.setOptions(e),this.setGallery(t)):"undefined"!=typeof t&&this.setOptions(t),this.setImage=function(){if(!a.length)return!0;var t=$(window).width(),e=$(window).height(),o=new Image;o.onload=function(){if(n=o.width,i=o.height,0==options.fillMode&&(t*=.9,e*=.95),n>t||i>e){var r;r=2==options.fillMode?e>i||t>n?1:Math.min(i/e,n/t):n/i>t/e?n/t:i/e,n/=r,i/=r}a.css({width:n+"px",height:i+"px",top:($(window).height()-i)/2+"px",left:($(window).width()-n)/2+"px"})},o.src=a.attr("src")},this.loadImage=function(t){if(l)return!1;if(t="undefined"==typeof t?!1:"left"==t?1:-1,a.length){if(t!==!1&&(r.length<2||options.quitOnEnd===!0&&(1===t&&0==targetID||-1===t&&targetID==r.length-1)))return s.self.quitLightbox(),!1;var e={opacity:0};g?f(a,100*t-o+"px",options.animationSpeed/1e3):e.left=parseInt(a.css("left"))+100*t+"px",a.animate(e,options.animationSpeed,function(){s.removeImage()}),o=0}l=!0,options.onLoadStart!==!1&&options.onLoadStart(),setTimeout(function(){a=$("<img "+options.selector+">").load(function(){a.appendTo("body"),s.setImage();var e={opacity:1};if(a.css("opacity",0),g)f(a,-100*t+"px",0),setTimeout(function(){f(a,"0px",options.animationSpeed/1e3)},50);else{var n=parseInt(a.css("left"));e.left=n+"px",a.css("left",n-100*t+"px")}if(a.animate(e,options.animationSpeed,function(){l=!1,options.onLoadEnd!==!1&&options.onLoadEnd()}),options.preloadNext){var i=targetID+1;0>i?i=r.length-1:i>=r.length&&(i=0),$("<img>").attr("src",r[i]).load()}}).error(function(){options.onLoadEnd!==!1&&options.onLoadEnd()}).attr("src",r[targetID]);var e=0,i=0,d=0;a.on(p?"pointerup MSPointerUp":"click",function(t){if(t.preventDefault(),options.quitOnImgClick)return s.self.quitLightbox(),!1;if(c(t.originalEvent))return!0;var e=(t.pageX||t.originalEvent.pageX)-t.target.offsetLeft;targetID+=n/2>e?-1:1,targetID<0?targetID=r.length-1:targetID>=r.length&&(targetID=0),s.loadImage(n/2>e?"left":"right")}).on("touchstart pointerdown MSPointerDown",function(t){return!c(t.originalEvent)||options.quitOnImgClick?!0:(g&&(d=parseInt(a.css("left"))),void(e=t.originalEvent.pageX||t.originalEvent.touches[0].pageX))}).on("touchmove pointermove MSPointerMove",function(t){return!c(t.originalEvent)||options.quitOnImgClick?!0:(t.preventDefault(),i=t.originalEvent.pageX||t.originalEvent.touches[0].pageX,o=e-i,void(g?f(a,-o+"px",0):a.css("left",d-o+"px")))}).on("touchend touchcancel pointerup pointercancel MSPointerUp MSPointerCancel",function(t){return!c(t.originalEvent)||options.quitOnImgClick?!0:void(Math.abs(o)>50?(targetID+=0>o?-1:1,targetID<0?targetID=r.length-1:targetID>=r.length&&(targetID=0),s.loadImage(o>0?"right":"left")):g?f(a,"0px",options.animationSpeed/1e3):a.animate({left:d+"px"},options.animationSpeed/2))})},options.animationSpeed+100)},this.removeImage=function(){return a.length?(a.remove(),void(a=$())):!1},this.quitLightbox=function(){return a.length?void a.animate({opacity:0},options.animationSpeed,function(){s.removeImage(),l=!1,options.onEnd!==!1&&options.onEnd()}):!1},this.addTrigger=function(t){return t.click(function(t){t.preventDefault(),options.onStart!==!1&&options.onStart(),targetID=Number($(this).data("id")),s.loadImage()})},$(function(){$(window).on("resize",s.setImage),options.quitOnDocClick&&$(document).on(u?"touchend":"click",function(t){a.length&&!$(t.target).is(a)&&s.quitLightbox()}),options.enableKeyboard&&$(document).on("keyup",function(t){return a.length?(t.preventDefault(),27==t.keyCode&&s.quitLightbox(),void((37==t.keyCode||39==t.keyCode)&&(targetID+=37==t.keyCode?-1:1,targetID<0?targetID=r.length-1:targetID>=r.length&&(targetID=0),s.loadImage(37==t.keyCode?"left":"right")))):!0})})}function TA(t,e,n,i,o,a){var r,l,s,d,g=0,f=!1,u=this;return this.lightbox=new imageLightbox({onStart:function(){TAlib.overlay.on(),TAlib.closeButton.on(),TAlib.allowRot=!1,u.stop()},onEnd:function(){TAlib.overlay.off(),TAlib.closeButton.off(),TAlib.loader.off(),TAlib.allowRot=!0,u.rotate()},onLoadStart:function(){TAlib.loader.on()},onLoadEnd:function(){TAlib.loader.off()},fillMode:"undefined"==typeof o?2:o}),this.images,this.nTiles=0,this.rotMany=1,this.rotDuration=650,this.rotDelay=500,this.probability=.85,this.ini=function(t,e,n,i,o){if(g=e.length,u.nTiles=i,g<u.nTiles)return!1;for(var a=new Array(g),s=0;g>s;s++)a[s]=e[s][1];u.lightbox.setGallery(a),u.images=e,r=new Array(g),d=new Array(g),l=$(t).html("").addClass("square-gallery");for(var s=0;s<u.nTiles;s++)r[s]={rotating:!1,tile:$('<div class="tile"></div>'),a:u.lightbox.addTrigger($('<a class="zoom" href="'+e[n+s][1]+'" target="_blank">').data("id",s)),img:$('<img src="'+e[n+s][0]+'">')},d[s]=n+s,l.append(r[s].tile.append(r[s].img).append(r[s].a));return o===!0&&u.rotate(),u},this.rotate=function(){if(u.images.length<=1||!u.rotMany)return!1;if(f=!0,u.rotMany>u.images.length-u.nTiles&&(u.rotMany=u.images.length-u.nTiles),!u.rotMany)return!1;if(TAlib.allowRot)for(var t=new Array(u.rotMany),e=0,n=0;n<t.length;n++){var i=20;do e=Math.floor(Math.random()*u.nTiles);while(-1!==t.indexOf(e)&&i-->0);t[n]=e,Math.random()<=u.probability&&u.rotateTile(e)}return clearTimeout(s),s=setTimeout(function(){u.rotate()},u.rotDelay),u},this.rotateTile=function(t){if("undefined"==typeof r[t])return console.log(r),console.log(t),!1;if(r[t].rotating===!0)return!1;r[t].rotating=!0;var e=0;do e=Math.floor(Math.random()*g);while(-1!==d.indexOf(e));d[t]=e;var n=$('<img src="'+u.images[e][0]+'">');return r[t].tile.append(n),r[t].img.addClass("slide"),r[t].a.attr("href",u.images[e][1]).data("id",e),setTimeout(function(){r[t].rotating=!1,r[t].img.remove(),r[t].img=n},u.rotDuration),u},this.stop=function(){return clearTimeout(s),f=!1,u},this.toggle=function(){return f?u.stop():u.rotate(),u},"undefined"!=typeof t&&"undefined"!=typeof e&&("undefined"==typeof n&&(n=0),"undefined"==typeof i&&(i=e.length),"undefined"==typeof a&&(a=!0),$(function(){u.ini(t,e,n,i,a)})),this}var TAlib={overlay:{created:!1,create:function(){return this.created?!1:(this.created=!0,void $("body").append('<div id="imagelightbox-overlay"></div>'))},on:function(){$("#imagelightbox-overlay").addClass("visible")},off:function(){$("#imagelightbox-overlay").removeClass("visible")}},loader:{created:!1,create:function(){return this.created?!1:(this.created=!0,void $("body").append('<div id="imagelightbox-loading"></div>'))},on:function(){$("#imagelightbox-loading").addClass("visible")},off:function(){$("#imagelightbox-loading").removeClass("visible")}},closeButton:{created:!1,create:function(){return this.created?!1:(this.created=!0,void $("body").append('<div id="imagelightbox-x">&times;</div>'))},on:function(){$("#imagelightbox-x").addClass("visible")},off:function(){$("#imagelightbox-x").removeClass("visible")}},createDefault:function(){$(function(){TAlib.overlay.create(),TAlib.loader.create(),TAlib.closeButton.create()})},allowRot:!0};TAlib.createDefault();
