/******************************************
square tiles gallery + integrated ligthbox
by mbc (http://altervista.cambiamentico.org/PAGES/experiments/faces-tiles/)
thanks to imagelightbox (http://osvaldas.info/image-lightbox-responsive-touch-friendly)
******************************************/
function imageLightbox(t,e){var i=0,n=0,o=0,a=$(),r=[],l="",s=!1;options={},targetID=0;var d=this,g=function(){var t=document.body||document.documentElement,t=t.style;return""==t.WebkitTransition?"-webkit-":""==t.MozTransition?"-moz-":""==t.OTransition?"-o-":""==t.transition?"":!1},f=g()===!1?!1:!0,c=function(t,e,i){var n={},o=g();n[o+"transform"]="translateX("+e+")",n[o+"transition"]=o+"transform "+i+"s linear",t.css(n)},u="ontouchstart"in window,p=window.navigator.pointerEnabled||window.navigator.msPointerEnabled,m=function(t){if(u)return!0;if(!p||"undefined"==typeof t||"undefined"==typeof t.pointerType)return!1;if("undefined"!=typeof t.MSPOINTER_TYPE_MOUSE){if(t.MSPOINTER_TYPE_MOUSE!=t.pointerType)return!0}else if("mouse"!=t.pointerType)return!0;return!1};this.setOptions=function(t){options=$.extend({selector:"imagelightbox",caption:"imagelightbox-text",specialitems:["imagelightbox-desc","imagelightbox-text"],allowedTypes:"png|jpg|jpeg|gif",animationSpeed:250,preloadNext:!0,enableKeyboard:!0,quitOnEnd:!1,quitOnImgClick:!1,quitOnDocClick:!0,onStart:!1,onEnd:!1,onLoadStart:!1,onLoadEnd:!1,fillMode:3},t)},this.updateoptions=function(t){options=$.extend(options,t)},this.setGallery=function(t){r=t},"undefined"!=typeof e?(this.setOptions(e),this.setGallery(t)):"undefined"!=typeof t&&this.setOptions(t),this.setImage=function(){if(!a.length)return!0;var t=$(window).width(),e=$(window).height(),o=new Image,l=options.fillMode;if(3==l){var s=t*e/1e4;l=35>s?2:70>s?1:0}o.onload=function(){if(i=o.width,n=o.height,0==l&&(t*=.9,e*=.95),i>t||n>e){var s;s=2==l?e>n||t>i?1:Math.min(n/e,i/t):i/n>t/e?i/t:n/e,i/=s,n/=s}a.css({width:i+"px",height:n+"px",top:($(window).height()-n)/2+"px",left:($(window).width()-i)/2+"px"}),$("#"+options.caption).html(r[targetID].desc.replace(/\r\n|\n|\r/g,"<br>"))},o.src=a.attr("src")},this.loadImage=function(t){if(s)return!1;if(t="undefined"==typeof t?!1:"left"==t?1:-1,a.length){if(t!==!1&&(r.length<2||options.quitOnEnd===!0&&(1===t&&0==targetID||-1===t&&targetID==r.length-1)))return d.self.quitLightbox(),!1;var e={opacity:0};f?c(a,100*t-o+"px",options.animationSpeed/1e3):e.left=parseInt(a.css("left"))+100*t+"px",a.animate(e,options.animationSpeed,function(){d.removeImage()}),o=0}s=!0,options.onLoadStart!==!1&&options.onLoadStart(),setTimeout(function(){a=$('<img id="'+options.selector+'">').load(function(){a.appendTo("body"),d.setImage();var e={opacity:1};if(a.css("opacity",0),f)c(a,-100*t+"px",0),setTimeout(function(){c(a,"0px",options.animationSpeed/1e3)},50);else{var i=parseInt(a.css("left"));e.left=i+"px",a.css("left",i-100*t+"px")}if(a.animate(e,options.animationSpeed,function(){s=!1,options.onLoadEnd!==!1&&options.onLoadEnd()}),options.preloadNext){var n=targetID+1;0>n?n=r.length-1:n>=r.length&&(n=0),$("<img>").attr("src",r[n].src).load()}}).error(function(){options.onLoadEnd!==!1&&options.onLoadEnd()}).attr("src",r[targetID].src);var e=0,n=0,l=0;if(u||p)a.on("touchstart pointerdown MSPointerDown",function(t){return!m(t.originalEvent)||options.quitOnImgClick?!0:(f&&(l=parseInt(a.css("left"))),void(e=t.originalEvent.pageX||t.originalEvent.touches[0].pageX))}).on("touchmove pointermove MSPointerMove",function(t){return!m(t.originalEvent)||options.quitOnImgClick?!0:(t.preventDefault(),n=t.originalEvent.pageX||t.originalEvent.touches[0].pageX,o=e-n,void(f?c(a,-o+"px",0):a.css("left",l-o+"px")))}).on("touchend touchcancel pointerup pointercancel MSPointerUp MSPointerCancel",function(t){return!m(t.originalEvent)||options.quitOnImgClick?!0:void(Math.abs(o)>50?(targetID+=0>o?-1:1,targetID<0?targetID=r.length-1:targetID>=r.length&&(targetID=0),d.loadImage(o>0?"right":"left")):f?c(a,"0px",options.animationSpeed/1e3):a.animate({left:l+"px"},options.animationSpeed/2))});else{var g=!1,h=0;a.mousedown(function(t){t.preventDefault(),g=!0,h=0,f&&(l=parseInt(a.css("left"))),e=t.originalEvent.pageX}).mousemove(function(t){return g?(n=t.originalEvent.pageX,o=e-n,h=Math.max(h,Math.abs(o)),void(f?c(a,-o+"px",0):a.css("left",l-o+"px"))):!0}).mouseup(function(t){if(!g)return!0;if(g=!1,Math.abs(o)>50)targetID+=0>o?-1:1,targetID<0?targetID=r.length-1:targetID>=r.length&&(targetID=0),d.loadImage(o>0?"right":"left");else{if(console.log(h),5>h){if(options.quitOnImgClick)return d.self.quitLightbox(),!1;var e=(t.pageX||t.originalEvent.pageX)-t.target.offsetLeft;if(i/3>e||e>2*i/3)return targetID+=i/2>e?-1:1,targetID<0?targetID=r.length-1:targetID>=r.length&&(targetID=0),d.loadImage(i/2>e?"left":"right"),!1}f?c(a,"0px",options.animationSpeed/1e3):a.animate({left:l+"px"},options.animationSpeed/2)}})}},options.animationSpeed+100)},this.removeImage=function(){return a.length?(a.remove(),void(a=$())):!1},this.quitLightbox=function(){return a.length?void a.animate({opacity:0},options.animationSpeed,function(){d.removeImage(),s=!1,options.onEnd!==!1&&options.onEnd()}):!1},this.addTrigger=function(t){return t.click(function(t){t.preventDefault(),options.onStart!==!1&&options.onStart(),targetID=Number($(this).data("id")),l=$(this).data("desc"),d.loadImage()})},$(function(){$(window).on("resize",d.setImage),options.quitOnDocClick&&$(document).on(u?"touchend":"click",function(t){a.length&&!$(t.target).is(a)&&-1===options.specialitems.indexOf(t.target.id)&&d.quitLightbox()}),options.enableKeyboard&&$(document).on("keyup",function(t){return a.length?(t.preventDefault(),27==t.keyCode&&d.quitLightbox(),void((37==t.keyCode||39==t.keyCode)&&(targetID+=37==t.keyCode?-1:1,targetID<0?targetID=r.length-1:targetID>=r.length&&(targetID=0),d.loadImage(37==t.keyCode?"left":"right")))):!0})})}function TA(t){var e,i,n,o,a=0,r=!1,l=this;return this.lightbox=new imageLightbox({onStart:function(){TAlib.overlay.on(),TAlib.closeButton.on(),$.each(TAlib.TAs,function(){this.stop()})},onEnd:function(){TAlib.overlay.off(),TAlib.closeButton.off(),TAlib.caption.off(),TAlib.loader.off(),$.each(TAlib.TAs,function(){this.rotate()})},onLoadStart:function(){TAlib.loader.on(),TAlib.caption.off()},onLoadEnd:function(){TAlib.loader.off(),TAlib.caption.on()}}),this.images,this.nTiles=0,this.rotMany=1,this.rotDuration=650,this.rotDelay=500,this.probability=.85,this.ini=function(t){if("undefined"==typeof t.id||!$.isArray(t.images))return!1;if(0===t.images.length)return!1;if(a=t.images.length,l.images=t.images,t=$.extend({from:0,n:a,autostart:!0,fill:3},t),l.nTiles=a<t.from+t.n?a-t.from:t.n,!l.nTiles)return!1;l.lightbox.updateoptions({fillMode:t.fill});for(var n=new Array(a),r=0;a>r;r++)"undefined"==typeof l.images[r][2]&&l.images[r].push(""),n[r]={src:t.images[r][1],desc:t.images[r][2]};l.lightbox.setGallery(n),e=new Array(a),o=new Array(a),i=$(t.id).html("").addClass("square-gallery");for(var r=0;r<l.nTiles;r++)e[r]={rotating:!1,tile:$('<div class="tile"></div>'),a:l.lightbox.addTrigger($('<a class="zoom" href="'+l.images[t.from+r][1]+'" target="_blank">').data("id",r).data("desc",l.images[t.from+r][2])),img:$('<img src="'+l.images[t.from+r][0]+'">')},o[r]=t.from+r,i.append(e[r].tile.append(e[r].img).append(e[r].a));return t.autostart===!0&&l.rotate(),l},this.rotate=function(){if(l.images.length<=1||!l.rotMany)return!1;if(r=!0,l.rotMany>l.images.length-l.nTiles&&(l.rotMany=l.images.length-l.nTiles),!l.rotMany)return!1;if(TAlib.allowRot)for(var t=new Array(l.rotMany),e=0,i=0;i<t.length;i++){var o=20;do e=Math.floor(Math.random()*l.nTiles);while(-1!==t.indexOf(e)&&o-->0);o&&(t[i]=e,Math.random()<=l.probability&&l.rotateTile(e))}return clearTimeout(n),n=setTimeout(function(){l.rotate()},l.rotDelay),l},this.rotateTile=function(t){if("undefined"==typeof e[t])return!1;if(e[t].rotating===!0)return!1;e[t].rotating=!0;var i=0;do i=Math.floor(Math.random()*a);while(-1!==o.indexOf(i));o[t]=i;var n=$('<img src="'+l.images[i][0]+'">');return e[t].tile.append(n),e[t].img.addClass("slide"),e[t].a.attr("href",l.images[i][1]).data("id",i).data("desc",l.images[i][2]),setTimeout(function(){e[t].rotating=!1,e[t].img.remove(),e[t].img=n},l.rotDuration),l},this.stop=function(){return clearTimeout(n),r=!1,l},this.toggle=function(){return r?l.stop():l.rotate(),l},$.isEmptyObject(t)||$(function(){l.ini(t)}),TAlib.TAs.push(this),this}var TAlib={overlay:{created:!1,create:function(){return TAlib.overlay.created?!1:(TAlib.overlay.created=!0,void $("body").append('<div id="imagelightbox-overlay"></div>'))},on:function(){$("#imagelightbox-overlay").addClass("visible")},off:function(){$("#imagelightbox-overlay").removeClass("visible")}},loader:{created:!1,create:function(){return TAlib.loader.created?!1:(TAlib.loader.created=!0,void $("body").append('<div id="imagelightbox-loading"></div>'))},on:function(){$("#imagelightbox-loading").addClass("visible")},off:function(){$("#imagelightbox-loading").removeClass("visible")}},closeButton:{created:!1,create:function(){return TAlib.closeButton.created?!1:(TAlib.closeButton.created=!0,void $("body").append('<div id="imagelightbox-x">&times;</div>'))},on:function(){$("#imagelightbox-x").addClass("visible")},off:function(){$("#imagelightbox-x").removeClass("visible")}},caption:{created:!1,create:function(t){return TAlib.caption.created?!1:(TAlib.caption.created=!0,void $("body").append('<div id="imagelightbox-desc"><div id="imagelightbox-text"'+(t?' class="'+t+'"':"")+"></div></div>"))},on:function(){""===$("#imagelightbox-text").html()?TAlib.caption.off():$("#imagelightbox-desc").addClass("visible")},off:function(){$("#imagelightbox-desc").removeClass("visible")}},createDefault:function(t){$(function(){TAlib.overlay.create(),TAlib.loader.create(),TAlib.caption.create(t),TAlib.closeButton.create()})},allowRot:!0,TAs:[]};TAlib.createDefault();
